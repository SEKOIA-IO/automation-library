mapping:
  ocsf_class: "user_inventory_info"
  class_uid: 5003
  version: "1.6.0"

  samples:
    - name: "Entra ID Active User"
      description: "Microsoft Entra ID user with console access and group membership"
      data: |
        {
          "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
          "userPrincipalName": "mary.jones@example.com",
          "displayName": "Mary Jones",
          "givenName": "Mary",
          "surname": "Jones",
          "mail": "mary.jones@example.com",
          "jobTitle": "Financial Analyst",
          "department": "Finance",
          "officeLocation": "New York, NY",
          "mobilePhone": "+1-555-234-5678",
          "businessPhones": ["+1-555-234-5678"],
          "createdDateTime": "2020-06-04T10:00:00Z",
          "lastSignInDateTime": "2025-08-26T09:30:00Z",
          "accountEnabled": true,
          "userType": "Member",
          "employeeId": "EMP456",
          "onPremisesUserPrincipalName": "mary.jones@example.com",
          "onPremisesSyncEnabled": true,
          "memberOf": [
            "Finance Users",
            "All Users"
          ],
          "assignedLicenses": [
            {
              "skuId": "6fd2c87f-bc8f-4e6d-8d55-d453c968c64f"
            }
          ]
        }

    - name: "Entra ID Disabled User"
      description: "Microsoft Entra ID user with account disabled"
      data: |
        {
          "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
          "userPrincipalName": "robert.smith@example.com",
          "displayName": "Robert Smith",
          "givenName": "Robert",
          "surname": "Smith",
          "mail": "robert.smith@example.com",
          "jobTitle": "Senior Software Engineer",
          "department": "Engineering",
          "officeLocation": "San Francisco, CA",
          "mobilePhone": "+1-555-345-6789",
          "businessPhones": ["+1-555-345-6789"],
          "createdDateTime": "2020-06-04T10:00:00Z",
          "lastSignInDateTime": "2025-06-10T14:00:00Z",
          "accountEnabled": false,
          "userType": "Member",
          "employeeId": "EMP789",
          "onPremisesUserPrincipalName": "robert.smith@example.com",
          "onPremisesSyncEnabled": true,
          "memberOf": [
            "Engineering Users"
          ],
          "assignedLicenses": []
        }

  fields:
    # USER IDENTIFICATION
    - source: "id"
      target: "user.uid"
      type: "string"
      logic: "Direct mapping of Microsoft Entra ID user UUID"
      description: "Microsoft Entra ID user unique identifier (UUID)"

    - source: "userPrincipalName"
      target: "user.name"
      type: "string"
      logic: "Direct mapping of user principal name"
      description: "User principal name (UPN) - email-like format"

    - source: "displayName"
      target: "user.full_name"
      type: "string"
      logic: "Direct mapping of display name"
      description: "User display name"

    # ACCOUNT INFORMATION
    - source: "userPrincipalName"
      target: "user.account.uid"
      type: "string"
      logic: "Direct mapping of user principal name"
      description: "Entra ID account identifier (UPN)"

    - source: "userPrincipalName"
      target: "user.account.name"
      type: "string"
      logic: "Direct mapping of user principal name"
      description: "Account username (UPN)"

    - source: "static: Entra ID"
      target: "user.account.type"
      type: "string"
      logic: "Always 'Entra ID'"
      description: "Account type identifier"

    - source: "static: 41"
      target: "user.account.type_id"
      type: "integer"
      logic: "Always 41 for Entra ID account type"
      description: "OCSF account type ID"

    # CONTACT INFORMATION
    - source: "mail"
      target: "user.email_addr"
      type: "string"
      logic: "Direct mapping of email address"
      description: "User email address"

    - source: "mobilePhone"
      target: "user.phone"
      type: "string"
      logic: "Direct mapping of mobile phone"
      description: "Mobile phone number"

    - source: "businessPhones | first"
      target: "user.work_phone"
      type: "string"
      logic: "Extract first business phone number"
      description: "Work phone number"

    # ORGANIZATIONAL INFORMATION
    - source: "department"
      target: "user.department"
      type: "string"
      logic: "Direct mapping of department attribute"
      description: "User department"

    - source: "jobTitle"
      target: "user.job_title"
      type: "string"
      logic: "Direct mapping of job title"
      description: "User job title"

    - source: "employeeId"
      target: "user.employee_id"
      type: "string"
      logic: "Direct mapping of employee ID"
      description: "Employee ID"

    - source: "officeLocation"
      target: "user.office_location"
      type: "string"
      logic: "Direct mapping of office location"
      description: "Office location"

    # USER STATUS & SECURITY
    - source: "accountEnabled"
      target: "user.is_enabled"
      type: "boolean"
      logic: "Direct mapping of account enabled status"
      description: "Whether user account is enabled"

    - source: "memberOf | length > 0"
      target: "user.has_groups"
      type: "boolean"
      logic: "true if user is member of any group, false otherwise"
      description: "Whether user belongs to any groups"

    - source: "memberOf"
      target: "user.groups"
      type: "array[object]"
      logic: "Create Group objects with group name as uid and name"
      description: "Group memberships"

    - source: "assignedLicenses | length > 0"
      target: "user.has_licenses"
      type: "boolean"
      logic: "true if user has assigned licenses, false otherwise"
      description: "Whether user has assigned licenses"

    - source: "assignedLicenses | length"
      target: "user.licenses_count"
      type: "integer"
      logic: "Count of assigned licenses"
      description: "Number of assigned licenses"

    # ON-PREMISES INFORMATION
    - source: "onPremisesUserPrincipalName"
      target: "user.on_premises_upn"
      type: "string"
      logic: "Direct mapping of on-premises UPN"
      description: "On-premises user principal name"

    - source: "onPremisesSyncEnabled"
      target: "user.is_synced"
      type: "boolean"
      logic: "Direct mapping of on-premises sync status"
      description: "Whether user is synced from on-premises"

    # TEMPORAL INFORMATION
    - source: "createdDateTime"
      target: "user.created_time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "User creation timestamp (Unix epoch)"

    - source: "lastSignInDateTime"
      target: "user.last_login_time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch; null if never signed in"
      description: "Last sign-in timestamp (Unix epoch)"

    - source: "createdDateTime"
      target: "time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch for OCSF event timestamp"
      description: "OCSF event timestamp (user discovery time)"

    # OCSF EVENT CLASSIFICATION
    - source: "static: 2"
      target: "activity_id"
      type: "integer"
      logic: "Always 2 for 'Collect' activity"
      description: "OCSF activity ID for inventory collection"

    - source: "static: Collect"
      target: "activity_name"
      type: "string"
      logic: "Always 'Collect'"
      description: "OCSF activity name"

    - source: "static: Discovery"
      target: "category_name"
      type: "string"
      logic: "Always 'Discovery'"
      description: "OCSF category name"

    - source: "static: 5"
      target: "category_uid"
      type: "integer"
      logic: "Always 5 for Discovery category"
      description: "OCSF category UID"

    - source: "static: User Inventory Info"
      target: "class_name"
      type: "string"
      logic: "Always 'User Inventory Info'"
      description: "OCSF class name"

    - source: "static: 5003"
      target: "class_uid"
      type: "integer"
      logic: "Always 5003 for User Inventory Info"
      description: "OCSF class UID"

    - source: "computed: 500300 + activity_id"
      target: "type_uid"
      type: "integer"
      logic: "Base 500300 + activity_id (2 = 500302)"
      description: "OCSF type UID"

    - source: "computed: class_name + ': ' + activity_name"
      target: "type_name"
      type: "string"
      logic: "Concatenate 'User Inventory Info: Collect'"
      description: "OCSF type name"

    - source: "static: Informational"
      target: "severity"
      type: "string"
      logic: "Always 'Informational' for inventory events"
      description: "Event severity level"

    - source: "static: 1"
      target: "severity_id"
      type: "integer"
      logic: "Always 1 for Informational severity"
      description: "OCSF severity ID"

    # METADATA
    - source: "static: Microsoft Entra ID"
      target: "metadata.product.name"
      type: "string"
      logic: "Always 'Microsoft Entra ID'"
      description: "Source product name"

    - source: "static: 1.6.0"
      target: "metadata.version"
      type: "string"
      logic: "Fixed OCSF schema version"
      description: "OCSF schema version"

    # OCSF ENRICHMENT - USER ACCESS INFORMATION
    - source: "accountEnabled"
      target: "enrichments[0].data.is_enabled"
      type: "boolean"
      logic: "Direct mapping of account enabled status"
      description: "Whether user account is enabled"

    - source: "lastSignInDateTime"
      target: "enrichments[0].data.last_sign_in"
      type: "integer"
      logic: "Convert ISO 8601 to Unix timestamp; return null if never signed in"
      description: "Last sign-in timestamp (Unix epoch)"

    - source: "userType"
      target: "enrichments[0].data.user_type"
      type: "string"
      logic: "Direct mapping of user type (Member, Guest, etc.)"
      description: "User type classification"

    - source: "assignedLicenses | length"
      target: "enrichments[0].data.assigned_licenses_count"
      type: "integer"
      logic: "Count of assigned licenses"
      description: "Number of assigned Microsoft 365 licenses"

    - source: "static: access_control"
      target: "enrichments[0].name"
      type: "string"
      logic: "Always 'access_control' for Entra ID enrichment type"
      description: "Enrichment object name"

    - source: "static: entra_id"
      target: "enrichments[0].value"
      type: "string"
      logic: "Always 'entra_id' for Entra ID user access enrichment"
      description: "Enrichment object value"

  ocsf_samples:
    - name: "User Inventory Info: Collect"
      description: "Transformed Entra ID user to OCSF User Inventory Info event"
      data: |
        {
          "activity_id": 2,
          "activity_name": "Collect",
          "category_name": "Discovery",
          "category_uid": 5,
          "class_name": "User Inventory Info",
          "class_uid": 5003,
          "type_name": "User Inventory Info: Collect",
          "type_uid": 500302,
          "severity": "Informational",
          "severity_id": 1,
          "time": 1591234567,
          "metadata": {
            "product": {
              "name": "Microsoft Entra ID"
            },
            "version": "1.6.0"
          },
          "user": {
            "uid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
            "name": "mary.jones@example.com",
            "full_name": "Mary Jones",
            "email_addr": "mary.jones@example.com",
            "is_enabled": true,
            "department": "Finance",
            "job_title": "Financial Analyst",
            "employee_id": "EMP456",
            "office_location": "New York, NY",
            "phone": "+1-555-234-5678",
            "work_phone": "+1-555-234-5678",
            "is_synced": true,
            "on_premises_upn": "mary.jones@example.com",
            "created_time": 1591234567,
            "last_login_time": 1691230000,
            "has_groups": true,
            "has_licenses": true,
            "licenses_count": 2,
            "account": {
              "uid": "mary.jones@example.com",
              "name": "mary.jones@example.com",
              "type": "Entra ID",
              "type_id": 41
            },
            "groups": [
              {
                "uid": "Finance Users",
                "name": "Finance Users"
              },
              {
                "uid": "All Users",
                "name": "All Users"
              }
            ]
          },
          "enrichments": [
            {
              "name": "access_control",
              "value": "entra_id",
              "data": {
                "is_enabled": true,
                "last_sign_in": 1691230000,
                "user_type": "Member",
                "assigned_licenses_count": 2
              }
            }
          ]
        }
