mapping:
  ocsf_class: "Device Inventory Info"
  class_uid: 5001
  ocsf_version: "1.6.0"

  samples:
    - name: "CrowdStrike falcon device sample"
      description: "Sample device data from CrowdStrike Falcon API"
      data: |
        {
          "device_id": "90111cd1dc1d1beea11cc111f1a11111",
          "cid": "d0f0000b0a000de0ab0000caf0f00fc0",
          "agent_load_flags": "0",
          "agent_local_time": "2025-09-08T12:48:35.942Z",
          "agent_version": "7.27.18003.0",
          "bios_manufacturer": "Xen",
          "bios_version": "4.11.amazon",
          "config_id_base": "66666662",
          "config_id_build": "10000",
          "config_id_platform": "8",
          "cpu_signature": "222222",
          "cpu_vendor": "0",
          "external_ip": "1.2.3.4",
          "mac_address": "00-33-66-11-99-99",
          "instance_id": "i-000b0000000a6000c",
          "service_provider": "AWS_EC2_V2",
          "service_provider_account_id": "333440842243",
          "hostname": "ip-1-2-3-4",
          "filesystem_containment_status": "normal",
          "first_seen": "2025-09-08T12:46:22Z",
          "last_seen": "2025-09-08T12:49:47Z",
          "local_ip": "2.3.0.2",
          "machine_domain": "",
          "major_version": "6",
          "minor_version": "8",
          "os_version": "Ubuntu 24.04",
          "platform_id": "3",
          "platform_name": "Linux",
          "policies": [
            {
              "policy_type": "prevention",
              "policy_id": "00000000d0000b0eb000dd00d000cd10",
              "applied": true,
              "settings_hash": "00a0000c",
              "assigned_date": "2025-09-08T12:47:56.934516164Z",
              "applied_date": "2025-09-08T12:49:50.129791663Z",
              "rule_groups": []
            }
          ],
          "reduced_functionality_mode": "no",
          "device_policies": {
            "prevention": {
              "policy_type": "prevention",
              "policy_id": "01000000d0000b0eb000dd00d0b70011",
              "applied": true,
              "settings_hash": "e0a0000c",
              "assigned_date": "2025-09-08T12:47:56.934516164Z",
              "applied_date": "2025-09-08T12:49:50.129791663Z",
              "rule_groups": []
            }
          },
          "groups": [],
          "group_hash": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
          "product_type_desc": "Server",
          "serial_number": "ec2c0000-0000-0000-0000-70de1a9d92c7",
          "status": "normal",
          "system_manufacturer": "Xen",
          "system_product_name": "HVM domU",
          "tags": [],
          "modified_timestamp": "2025-09-08T12:49:57Z",
          "meta": { "version": "6", "version_string": "31:15400986742" },
          "zone_group": "eu-west-3a",
          "kernel_version": "6.8.0-1026-aws",
          "chassis_type": "1",
          "chassis_type_desc": "Other",
          "pod_labels": [],
          "pod_annotations": [],
          "connection_ip": "11.00.00.00",
          "default_gateway_ip": "11.00.00.00",
          "connection_mac_address": "00-00-00-11-99-99",
          "linux_sensor_mode": "User Mode",
          "deployment_type": "Standard"
        }
  fields:
    # DEVICE IDENTIFICATION
    - source: "device_id"
      target: "device.uid"
      type: "string"
      logic: "Direct mapping of CrowdStrike device unique ID"
      description: "Device unique identifier"

    - source: "hostname"
      target: "device.hostname"
      type: "string"
      logic: "Direct mapping of device hostname"
      description: "Device hostname"

    - source: "hostname"
      target: "device.name"
      type: "string"
      logic: "Direct mapping of device hostname as name"
      description: "Device name"

    - source: "serial_number"
      target: "device.uid_alt"
      type: "string"
      logic: "Direct mapping of device serial number"
      description: "Alternative device identifier (serial number)"

    # OPERATING SYSTEM
    - source: "platform_name"
      target: "device.os.type"
      type: "string"
      logic: "Map platform_name: 'windows'→Windows, 'linux'→Linux, 'mac'→macOS, 'ios'→iOS, 'android'→Android"
      description: "Operating system type"

    - source: "platform_name"
      target: "device.os.type_id"
      type: "integer"
      logic: "Map OS type to OCSF ID: Windows→100, Linux→200, macOS→300, iOS→400, Android→401, Unknown→0"
      description: "OCSF operating system type ID"

    - source: "os_version"
      target: "device.os.name"
      type: "string"
      logic: "Direct mapping of OS version string (e.g., '10 (Build 19045)', 'Ubuntu 20.04 LTS')"
      description: "Operating system name with version"

    # DEVICE CLASSIFICATION
    - source: "product_type_desc"
      target: "device.type"
      type: "string"
      logic: "Map product_type_desc: 'server'→Server, 'workstation'→Desktop, 'desktop'→Desktop, 'laptop'→Laptop, 'mobile'→Mobile, 'tablet'→Tablet, 'virtual'→Virtual"
      description: "Device type"

    - source: "product_type_desc"
      target: "device.type_id"
      type: "integer"
      logic: "Map device type to OCSF ID: Server→1, Desktop→2, Laptop→8, Mobile→9, Tablet→10, Virtual→16, Unknown→0"
      description: "OCSF device type ID"

    # HARDWARE
    - source: "system_manufacturer"
      target: "device.vendor_name"
      type: "string"
      logic: "Direct mapping of system manufacturer"
      description: "Device hardware vendor/manufacturer"

    - source: "system_product_name"
      target: "device.model"
      type: "string"
      logic: "Direct mapping of system product name"
      description: "Device model name"

    - source: "bios_manufacturer"
      target: "device.hypervisor"
      type: "string"
      logic: "Direct mapping of BIOS manufacturer (hypervisor for virtual devices)"
      description: "Hypervisor or BIOS manufacturer"

    # NETWORK INTERFACES - PRIMARY
    - source: "local_ip"
      target: "device.network_interfaces[0].ip"
      type: "ip"
      logic: "Direct mapping of local IP address for primary interface"
      description: "Primary network interface IP address"

    - source: "mac_address"
      target: "device.network_interfaces[0].mac"
      type: "string"
      logic: "Normalize MAC address to format 'XX:XX:XX:XX:XX:XX'"
      description: "Primary network interface MAC address"

    - source: "hostname"
      target: "device.network_interfaces[0].hostname"
      type: "string"
      logic: "Direct mapping of device hostname"
      description: "Primary interface hostname/DNS name"

    - source: "static: primary"
      target: "device.network_interfaces[0].name"
      type: "string"
      logic: "Always 'primary' for first network interface"
      description: "Primary interface name"

    # NETWORK INTERFACES - CONNECTION
    - source: "connection_ip"
      target: "device.network_interfaces[1].ip"
      type: "ip"
      logic: "Map connection_ip only if different from local_ip; skip if identical"
      description: "Connection/external network interface IP address"

    - source: "connection_mac_address"
      target: "device.network_interfaces[1].mac"
      type: "string"
      logic: "Normalize MAC address to format 'XX:XX:XX:XX:XX:XX'; only if connection_ip differs from local_ip"
      description: "Connection interface MAC address"

    - source: "static: connection"
      target: "device.network_interfaces[1].name"
      type: "string"
      logic: "Always 'connection' for second network interface if it exists"
      description: "Connection interface name"

    # PRIMARY IP ADDRESS
    - source: "local_ip"
      target: "device.ip"
      type: "ip"
      logic: "Prefer local_ip for primary device IP"
      description: "Primary device IP address"

    # NETWORK LOCATION
    - source: "machine_domain"
      target: "device.domain"
      type: "string"
      logic: "Direct mapping of machine domain"
      description: "Device domain membership"

    - source: "default_gateway_ip"
      target: "device.subnet"
      type: "ip"
      logic: "Direct mapping of gateway IP as subnet reference"
      description: "Default gateway/subnet identifier"

    # DEVICE GROUPS
    - source: "groups[]"
      target: "device.groups[]"
      type: "object"
      logic: "Map each group ID to a Group object with uid and name (fetched from API)"
      description: "Device group memberships and assignments"

    # SECURITY & POLICY STATUS
    - source: "device_policies.firewall.applied"
      target: "device.is_managed"
      type: "boolean"
      logic: "true if firewall policy is applied; indicates device is actively managed"
      description: "Whether device is under active management"

    - source: "status + reduced_functionality_mode + filesystem_containment_status"
      target: "device.is_compliant"
      type: "boolean"
      logic: "true if status='normal' AND reduced_functionality_mode='no' AND filesystem_containment_status='normal'; else false; null if unable to determine"
      description: "Device compliance status"

    - source: "static: Informational"
      target: "device.state"
      type: "string"
      logic: "Map status field: 'normal'→'Normal', 'issue'→'Issue', 'offline'→'Offline'"
      description: "Device operational state"

    # AGENT & SOFTWARE
    - source: "agent_version"
      target: "device.agent_version"
      type: "string"
      logic: "Direct mapping of CrowdStrike agent version"
      description: "CrowdStrike Falcon agent version"

    # GEOGRAPHIC/ORGANIZATIONAL
    - source: "zone_group"
      target: "device.region"
      type: "string"
      logic: "Direct mapping of zone/region grouping"
      description: "Geographic zone or region"

    - source: "cid"
      target: "device.org.uid"
      type: "string"
      logic: "Direct mapping of CrowdStrike CID (customer ID)"
      description: "Organization/Customer unique identifier"

    - source: "static: CrowdStrike"
      target: "device.org.name"
      type: "string"
      logic: "Always 'CrowdStrike' as organization source"
      description: "Organization name"

    # TIMESTAMPS
    - source: "first_seen"
      target: "device.created_time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Device first detection timestamp"

    - source: "agent_local_time"
      target: "device.boot_time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch; represents last known agent local time (proxy for boot)"
      description: "Device boot time (approximation from agent local time)"

    - source: "last_seen"
      target: "device.updated_time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Device last seen/updated timestamp"

    - source: "modified_timestamp"
      target: "time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch; use for OCSF event timestamp; fallback to first_seen"
      description: "OCSF event timestamp"

    # DESCRIPTION
    - source: "product_type_desc + platform_name"
      target: "device.desc"
      type: "string"
      logic: "Concatenate as '<product_type_desc> - <platform_name>' (e.g., 'Workstation - Windows')"
      description: "Device description"

    # METADATA
    - source: "static: CrowdStrike Falcon"
      target: "metadata.product.name"
      type: "string"
      logic: "Always 'CrowdStrike Falcon'"
      description: "Source product name"

    - source: "agent_version"
      target: "metadata.product.version"
      type: "string"
      logic: "Direct mapping of agent_version"
      description: "Product version (agent version)"

    - source: "static: 1.6.0"
      target: "metadata.version"
      type: "string"
      logic: "Fixed OCSF schema version"
      description: "OCSF schema version"

    # OCSF EVENT CLASSIFICATION
    - source: "static: 2"
      target: "activity_id"
      type: "integer"
      logic: "Always 2 for 'Collect' activity"
      description: "OCSF activity ID"

    - source: "static: Collect"
      target: "activity_name"
      type: "string"
      logic: "Always 'Collect' for asset inventory"
      description: "OCSF activity name"

    - source: "static: Discovery"
      target: "category_name"
      type: "string"
      logic: "Always 'Discovery'"
      description: "OCSF category name"

    - source: "static: 5"
      target: "category_uid"
      type: "integer"
      logic: "Always 5 for Discovery category"
      description: "OCSF category UID"

    - source: "static: Device Inventory Info"
      target: "class_name"
      type: "string"
      logic: "Always 'Device Inventory Info'"
      description: "OCSF class name"

    - source: "static: 5001"
      target: "class_uid"
      type: "integer"
      logic: "Always 5001 for Device Inventory Info"
      description: "OCSF class UID"

    - source: "computed: 500100 + activity_id"
      target: "type_uid"
      type: "integer"
      logic: "Base 500100 + activity_id (2 = 500102)"
      description: "OCSF type UID"

    - source: "computed: class_name + ': ' + activity_name"
      target: "type_name"
      type: "string"
      logic: "Concatenate 'Device Inventory Info: Collect'"
      description: "OCSF type name"

    - source: "static: Informational"
      target: "severity"
      type: "string"
      logic: "Always 'Informational' for inventory events"
      description: "Event severity"

    - source: "static: 1"
      target: "severity_id"
      type: "integer"
      logic: "Always 1 for Informational severity"
      description: "OCSF severity ID"

  ocsf_samples:
    - name: "Device Inventory Info"
      description: "Transformed CrowdStrike falcon api response to OCSF Device Inventory Info"
      data: |
        {
          "activity_id": 2,
          "activity_name": "Collect",
          "category_name": "Discovery",
          "category_uid": 5,
          "class_name": "Device Inventory Info",
          "class_uid": 5001,
          "type_name": "Device Inventory Info: Collect",
          "type_uid": 500102,
          "severity": "Informational",
          "severity_id": 1,
          "time": 1725011130,
          "metadata": {
            "product": {
              "name": "CrowdStrike Falcon",
              "version": "7.8.0.0"
            },
            "version": "1.6.0"
          },
          "device": {
            "uid": "abc000def000ghi000",
            "uid_alt": "1A2B3C4D5E6F",
            "name": "WORKSTATIONTEST-001",
            "hostname": "WORKSTATIONTEST-001",
            "type": "Desktop",
            "type_id": 2,
            "vendor_name": "Dell Inc.",
            "model": "OptiPlex 7090",
            "hypervisor": "Dell Inc.",
            "ip": "1.1.1.1",
            "domain": "example.com",
            "region": "US-EAST",
            "state": "Normal",
            "agent_version": "7.8.0.0",
            "is_managed": true,
            "is_compliant": true,
            "created_time": 1705329000,
            "boot_time": 1725011130,
            "updated_time": 1725011130,
            "subnet": "192.168.1.1",
            "desc": "Workstation - Windows",
            "os": {
              "name": "10 (Build 19045)",
              "type": "Windows",
              "type_id": 100
            },
            "network_interfaces": [
              {
                "name": "primary",
                "ip": "192.168.1.100",
                "hostname": "WORKSTATION-001",
                "mac": "00:1A:2B:3C:4D:5E"
              }
            ],
            "groups": [
              {
                "uid": "default",
                "name": "default"
              },
              {
                "uid": "managed-endpoints",
                "name": "managed-endpoints"
              }
            ],
            "org": {
              "uid": "abc123def456",
              "name": "CrowdStrike"
            }
          }
        }
