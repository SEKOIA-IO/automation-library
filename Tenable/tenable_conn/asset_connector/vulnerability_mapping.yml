mapping:
  ocsf_class: "vulnerability_finding"
  class_uid: 2002
  version: "1.6.0"

  samples:
    - name: "Tenable Critical Vulnerability"
      description: "Critical vulnerability finding with CVE information"
      data: |
        {
          "vuln": {
            "finding_id": "finding_12345",
            "state": "OPEN",
            "first_found": "2024-01-15T10:30:00.000Z",
            "last_found": "2025-08-26T09:30:00.000Z",
            "severity": "critical",
            "plugin": {
              "id": 11219,
              "name": "Microsoft Windows SMB Shares Enumeration",
              "type": "remote",
              "synopsis": "The remote host is running an operating system that supports SMB.",
              "description": "The remote host is running an operating system that supports SMB. It is possible to enumerate shares on the remote host.",
              "see_also": [
                "https://tools.ietf.org/html/rfc1001",
                "https://tools.ietf.org/html/rfc1002"
              ],
              "cve": [
                "CVE-2020-1234",
                "CVE-2020-5678"
              ],
              "cvss_base_score": 9.8,
              "cvss3_base_score": 9.8,
              "publication_date": "2020-06-15T00:00:00.000Z",
              "version": "1.42",
              "vpr_v2": {
                "score": 8.5
              }
            },
            "source": "tenable_io"
          },
          "asset_info": {
            "id": "a1b2c3d4e5f6g7h8",
            "name": "PROD-SERVER-001",
            "fqdn": [
              "prod-server-001.example.com"
            ],
            "hostname": [
              "PROD-SERVER-001"
            ],
            "ipv4": [
              "192.168.1.50",
              "10.0.0.25"
            ],
            "system_type": [
              "General Purpose"
            ],
            "operating_system": [
              "Windows Server 2019"
            ],
            "aws_region": [
              "us-east-1"
            ],
            "first_seen": "2023-06-04T10:00:00.000Z",
            "last_seen": "2025-08-26T09:30:00.000Z",
            "created_at": "2023-06-04T10:00:00.000Z",
            "has_agent": true,
            "interfaces": [
              {
                "name": "eth0",
                "ipv4": "192.168.1.50",
                "mac": "00:1A:2B:3C:4D:5E"
              }
            ]
          }
        }

    - name: "Tenable Medium Vulnerability"
      description: "Medium severity vulnerability finding"
      data: |
        {
          "vuln": {
            "finding_id": "finding_67890",
            "state": "REOPENED",
            "first_found": "2024-03-20T14:15:00.000Z",
            "last_found": "2025-08-20T08:45:00.000Z",
            "severity": "medium",
            "plugin": {
              "id": 10662,
              "name": "Apache Web Server Multiple Vulnerabilities",
              "type": "remote",
              "synopsis": "The remote host is running Apache Web Server.",
              "description": "The remote host is running a version of Apache Web Server that is affected by multiple vulnerabilities.",
              "see_also": [
                "https://httpd.apache.org/security/vulnerabilities_24.html"
              ],
              "cve": [
                "CVE-2021-41773"
              ],
              "cvss_base_score": 7.5,
              "cvss3_base_score": 7.5,
              "publication_date": "2021-10-05T00:00:00.000Z",
              "version": "2.15",
              "vpr_v2": {
                "score": 5.2
              }
            },
            "source": "tenable_io"
          },
          "asset_info": {
            "id": "b2c3d4e5f6g7h8i9",
            "name": "WEB-SERVER-002",
            "fqdn": [
              "web-server-002.example.com"
            ],
            "hostname": [
              "WEB-SERVER-002"
            ],
            "ipv4": [
              "192.168.1.60"
            ],
            "system_type": [
              "Web Server"
            ],
            "operating_system": [
              "Ubuntu 20.04 LTS"
            ],
            "gcp_zone": [
              "us-central1-a"
            ],
            "first_seen": "2023-06-04T10:00:00.000Z",
            "last_seen": "2025-08-26T09:30:00.000Z",
            "created_at": "2023-06-04T10:00:00.000Z",
            "has_agent": false,
            "interfaces": [
              {
                "name": "eth0",
                "ipv4": "192.168.1.60",
                "mac": "00:2C:3D:4E:5F:60"
              }
            ]
          }
        }

  fields:
    # VULNERABILITY STATE MAPPING
    - source: "vuln.state"
      target: "activity_id"
      type: "integer"
      logic: "Map OPEN=1 (Create), REOPENED=2 (Updated), FIXED=3 (Close)"
      description: "OCSF activity ID based on vulnerability state"

    - source: "vuln.state"
      target: "activity_name"
      type: "string"
      logic: "Map state to activity (OPEN->Create, REOPENED->Updated, FIXED->Close)"
      description: "OCSF activity name derived from vulnerability state"

    - source: "static: Findings"
      target: "category_name"
      type: "string"
      logic: "Always 'Findings' for vulnerability findings"
      description: "OCSF category name for security findings"

    - source: "static: 2"
      target: "category_uid"
      type: "integer"
      logic: "Always 2 for Findings category"
      description: "OCSF category UID"

    - source: "static: Vulnerability Finding"
      target: "class_name"
      type: "string"
      logic: "Always 'Vulnerability Finding'"
      description: "OCSF class name"

    - source: "static: 2002"
      target: "class_uid"
      type: "integer"
      logic: "Always 2002 for Vulnerability Finding"
      description: "OCSF class UID"

    - source: "computed: 200200 + activity_id"
      target: "type_uid"
      type: "integer"
      logic: "Base 200200 + activity_id (1=200201, 2=200202, 3=200203)"
      description: "OCSF type UID"

    - source: "computed: 'Vulnerability Finding: ' + activity_name"
      target: "type_name"
      type: "string"
      logic: "Concatenate 'Vulnerability Finding: ' with activity name"
      description: "OCSF type name"

    - source: "vuln.first_found"
      target: "time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch for OCSF event timestamp"
      description: "OCSF event timestamp (vulnerability first found time)"

    # METADATA
    - source: "static: Tenable"
      target: "metadata.product.name"
      type: "string"
      logic: "Always 'Tenable'"
      description: "Source product name"

    - source: "vuln.plugin.version"
      target: "metadata.version"
      type: "string"
      logic: "Direct mapping of plugin version"
      description: "Plugin/mapping version"

    - source: "static: 1.6.0"
      target: "metadata.ocsf_version"
      type: "string"
      logic: "Fixed OCSF schema version"
      description: "OCSF schema version"

    # FINDING INFORMATION
    - source: "vuln.finding_id"
      target: "finding.uid"
      type: "string"
      logic: "Direct mapping of finding identifier"
      description: "Unique finding identifier"

    - source: "vuln.plugin.type"
      target: "finding.type"
      type: "string"
      logic: "Direct mapping of plugin type (remote, local, etc.)"
      description: "Finding type"

    - source: "vuln.source"
      target: "finding.source"
      type: "string"
      logic: "Direct mapping of vulnerability source"
      description: "Source system of the finding"

    - source: "vuln.plugin.name"
      target: "finding.title"
      type: "string"
      logic: "Direct mapping of plugin name as finding title"
      description: "Finding title"

    - source: "vuln.plugin.synopsis || vuln.plugin.description"
      target: "finding.description"
      type: "string"
      logic: "Use synopsis if available, otherwise use description"
      description: "Finding description"

    - source: "vuln.plugin.see_also[0]"
      target: "finding.reference_url"
      type: "string"
      logic: "Extract first reference URL from see_also array"
      description: "Primary reference URL"

    - source: "vuln.first_found"
      target: "finding.first_seen_time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Finding first seen timestamp (Unix epoch)"

    - source: "vuln.last_found"
      target: "finding.last_seen_time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Finding last seen timestamp (Unix epoch)"

    - source: "vuln.plugin.publication_date"
      target: "finding.created_time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Finding/vulnerability creation timestamp (Unix epoch)"

    - source: "static: Tenable Vulnerability Management"
      target: "finding.product.name"
      type: "string"
      logic: "Always 'Tenable Vulnerability Management'"
      description: "Product providing the finding"

    - source: "static: N/A"
      target: "finding.fingerprints"
      type: "string"
      logic: "Placeholder for fingerprint data"
      description: "Finding fingerprints"

    - source: "static: [{phase: Other, phase_id: 99}]"
      target: "finding.kill_chain"
      type: "array[object]"
      logic: "Default kill chain phase"
      description: "Kill chain phases"

    # VULNERABILITIES
    - source: "vuln.plugin.cve"
      target: "vulnerabilities"
      type: "array[object]"
      logic: "Create vulnerability objects with CVE IDs"
      description: "Associated vulnerabilities/CVEs"

    - source: "static: CVE"
      target: "vulnerabilities[0].type"
      type: "string"
      logic: "Always 'CVE' for vulnerability type"
      description: "Vulnerability type identifier"

    - source: "vuln.plugin.cvss_base_score"
      target: "vulnerabilities[0].cvss.score"
      type: "double"
      logic: "Direct mapping of CVSS base score"
      description: "CVSS base score"

    - source: "vuln.plugin.cvss3_base_score"
      target: "vulnerabilities[0].cvss3.score"
      type: "double"
      logic: "Direct mapping of CVSS v3 base score"
      description: "CVSS v3 base score"

    - source: "vuln.plugin.description"
      target: "vulnerabilities[0].description"
      type: "string"
      logic: "Direct mapping of plugin description"
      description: "Vulnerability description"

    - source: "vuln.plugin.name"
      target: "vulnerabilities[0].name"
      type: "string"
      logic: "Direct mapping of plugin name as vulnerability name"
      description: "Vulnerability name"

    - source: "vuln.plugin.name"
      target: "vulnerabilities[0].title"
      type: "string"
      logic: "Direct mapping of plugin name as vulnerability title"
      description: "Vulnerability title"

    - source: "vuln.plugin.description"
      target: "vulnerabilities[0].details"
      type: "string"
      logic: "Direct mapping of plugin description for details"
      description: "Vulnerability details"

    - source: "vuln.plugin.see_also"
      target: "vulnerabilities[0].references"
      type: "array[string]"
      logic: "Direct mapping of see_also links as references"
      description: "Vulnerability reference links"

    - source: "vuln.severity"
      target: "vulnerabilities[0].severity"
      type: "string"
      logic: "Direct mapping of severity (critical, high, medium, low, info)"
      description: "Vulnerability severity level"

    - source: "static: Tenable"
      target: "vulnerabilities[0].source"
      type: "string"
      logic: "Always 'Tenable'"
      description: "Vulnerability source"

    # DEVICE
    - source: "asset_info.id"
      target: "device.uid"
      type: "string"
      logic: "Direct mapping of asset ID"
      description: "Device unique identifier"

    - source: "asset_info.system_type[0]"
      target: "device.type"
      type: "string"
      logic: "Direct mapping of system type"
      description: "Device type"

    - source: "asset_info.system_type[0]"
      target: "device.type_id"
      type: "integer"
      logic: "Map system type to OCSF device type ID"
      description: "OCSF device type ID"

    - source: "asset_info.hostname[0] || asset_info.name || asset_info.fqdn[0]"
      target: "device.hostname"
      type: "string"
      logic: "Use hostname if available, otherwise name, otherwise FQDN"
      description: "Device hostname"

    - source: "asset_info.name"
      target: "device.name"
      type: "string"
      logic: "Direct mapping of asset name"
      description: "Device name"

    - source: "asset_info.ipv4[0]"
      target: "device.ip"
      type: "string"
      logic: "Extract first IPv4 address"
      description: "Primary IPv4 address"

    - source: "asset_info.operating_system[0]"
      target: "device.os.name"
      type: "string"
      logic: "Direct mapping of operating system"
      description: "Operating system name"

    - source: "asset_info.operating_system[0]"
      target: "device.os.type"
      type: "string"
      logic: "Map OS to OCSF OS type enum"
      description: "Operating system type"

    - source: "asset_info.operating_system[0]"
      target: "device.os.version"
      type: "string"
      logic: "Extract version from OS string if available"
      description: "Operating system version"

    - source: "asset_info.interfaces"
      target: "device.network_interfaces"
      type: "array[object]"
      logic: "Direct mapping of network interfaces"
      description: "Network interfaces"

    - source: "asset_info.aws_region[0] || asset_info.azure_location[0] || asset_info.gcp_zone[0]"
      target: "device.region"
      type: "string"
      logic: "Use AWS region if available, otherwise Azure location, otherwise GCP zone"
      description: "Cloud region/location"

    - source: "asset_info.first_seen"
      target: "device.created_time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Device creation/first seen timestamp (Unix epoch)"

    - source: "asset_info.last_seen"
      target: "device.last_seen_time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Device last seen timestamp (Unix epoch)"

    - source: "asset_info.created_at"
      target: "device.updated_time"
      type: "integer"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Device updated timestamp (Unix epoch)"

    - source: "asset_info.has_agent"
      target: "device.has_agent"
      type: "boolean"
      logic: "Direct mapping of agent presence"
      description: "Whether device has Tenable agent"

    - source: "static: Tenable"
      target: "device.source"
      type: "string"
      logic: "Always 'Tenable'"
      description: "Device information source"

    # CONFIDENCE & SEVERITY
    - source: "vuln.plugin.vpr_v2.score"
      target: "severity"
      type: "string"
      logic: "Map VPR score to severity level (8.5+=Critical, 6.5+=High, 4.5+=Medium, 2.5+=Low, <2.5=Informational)"
      description: "Overall event severity"

    - source: "vuln.plugin.vpr_v2.score"
      target: "severity_id"
      type: "integer"
      logic: "Map VPR score to OCSF severity ID (5=Critical, 4=High, 3=Medium, 2=Low, 1=Informational)"
      description: "OCSF severity ID"

    - source: "vuln.plugin.vpr_v2.score"
      target: "confidence_id"
      type: "integer"
      logic: "Map VPR score to confidence (3=High [7+], 2=Medium [4-7), 1=Low [<4])"
      description: "OCSF confidence ID based on VPR score"

  ocsf_samples:
    - name: "Vulnerability Finding: Create"
      description: "Transformed Tenable vulnerability finding to OCSF Vulnerability Finding event"
      data: |
        {
          "activity_id": 1,
          "activity_name": "Create",
          "category_name": "Findings",
          "category_uid": 2,
          "class_name": "Vulnerability Finding",
          "class_uid": 2002,
          "type_name": "Vulnerability Finding: Create",
          "type_uid": 200201,
          "severity": "Critical",
          "severity_id": 5,
          "confidence_id": 3,
          "time": 1705314600,
          "metadata": {
            "product": {
              "name": "Tenable"
            },
            "version": "1.42"
          },
          "finding": {
            "uid": "finding_12345",
            "type": "remote",
            "source": "tenable_io",
            "title": "Microsoft Windows SMB Shares Enumeration",
            "description": "The remote host is running an operating system that supports SMB. It is possible to enumerate shares on the remote host.",
            "reference_url": "https://tools.ietf.org/html/rfc1001",
            "first_seen_time": 1705314600,
            "last_seen_time": 1725184200,
            "created_time": 1592179200,
            "product": {
              "name": "Tenable Vulnerability Management"
            },
            "fingerprints": "N/A",
            "kill_chain": [
              {
                "phase": "Other",
                "phase_id": 99
              }
            ]
          },
          "vulnerabilities": [
            {
              "type": "CVE",
              "name": "CVE-2020-1234",
              "title": "Microsoft Windows SMB Shares Enumeration",
              "description": "The remote host is running an operating system that supports SMB.",
              "details": "The remote host is running an operating system that supports SMB. It is possible to enumerate shares on the remote host.",
              "severity": "critical",
              "source": "Tenable",
              "references": [
                "https://tools.ietf.org/html/rfc1001",
                "https://tools.ietf.org/html/rfc1002"
              ],
              "cvss": {
                "score": 9.8
              },
              "cvss3": {
                "score": 9.8
              }
            }
          ],
          "device": {
            "uid": "a1b2c3d4e5f6g7h8",
            "name": "PROD-SERVER-001",
            "hostname": "PROD-SERVER-001",
            "type": "General Purpose",
            "ip": "192.168.1.50",
            "has_agent": true,
            "region": "us-east-1",
            "source": "Tenable",
            "created_time": 1685854800,
            "updated_time": 1685854800,
            "last_seen_time": 1725184200,
            "os": {
              "name": "Windows Server 2019",
              "type": "Windows",
              "version": "2019"
            },
            "network_interfaces": [
              {
                "name": "eth0",
                "ipv4": "192.168.1.50",
                "mac": "00:1A:2B:3C:4D:5E"
              }
            ]
          }
        }
