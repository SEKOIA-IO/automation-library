mapping:
  ocsf_class: "Device Inventory Info"
  class_uid: 5001
  ocsf_version: "1.6.0"

  samples:
    - name: "HarfangLab Device Inventory Sample"
      description: "Agent data sample for harfanglab api response."
      data: |
        {
          "id": "3891597d-8696-4fc4-a260-b04880bdbd68",
          "group_count": null,
          "groups": [],
          "status": "offline",
          "policy": {
            "id": "eaa79dde-2c4c-4fb8-822b-20a0529ba6db",
            "tenant": null,
            "origin_stack": null,
            "macos_paths_muted_exact": [
              "/Applications/Avast.app/Contents/Backend/utils/com.avast.Antivirus.EndpointSecurity.app/Contents/MacOS/com.avast.Antivirus.EndpointSecurity.",
              "/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/Metadata.framework/Versions/A/Support/corespotlightd"
            ],
            "macos_paths_muted_prefixes": [
              "/Applications/WithSecure/WithSecure Agent.app/",
              "/usr/libexec/"
            ],
            "macos_paths_muted_globs": [],
            "macos_paths_read_watched_exact": [
              "/private/etc/kcpassword",
              "/System/Library/Sandbox/rootless.conf"
            ],
            "macos_paths_read_watched_prefixes": [
              "/private/var/db/dslocal/nodes/Default/users/",
              "/Library/Keychains/",
              "/Network/Library/Keychains/"
            ],
            "macos_paths_read_watched_globs": [
              "/Users/*/Library/Application Support/Litecoin/wallets/**",
              "/Users/*/.ssh/*",
              "/Users/*/Library/Application Support/Microsoft Edge/*/**"
            ],
            "macos_paths_write_watched_exact": [
              "/Library/Application Support/com.apple.TCC/TCC.db"
            ],
            "macos_paths_write_watched_prefixes": [
              "/System/Library/LaunchAgents/",
              "/Library/Scripts/"
            ],
            "macos_paths_write_watched_globs": [
              "/Users/*/Library/Preferences/**",
              "/Users/*/Library/LaunchAgents/**"
            ],
            "macos_paths_other_watched_exact": [
              "/Library/Application Support/com.apple.TCC/TCC.db"
            ],
            "macos_paths_other_watched_prefixes": [
              "/System/Library/LaunchAgents/",
              "/Library/Scripts/"
            ],
            "macos_paths_other_watched_globs": [
              "/Users/*/Documents/**",
              "/private/var/folders/**/NSCreateObjectFileImageFromMemory-*"
            ],
            "windows_read_watched_paths": [
              "*\\PROGRAM FILES*",
              "*\\WINDOWS\\SYSTEM32\\CONFIG\\*"
            ],
            "windows_write_watched_paths": [
              "*\\PROGRAM FILES*",
              "*\\USERS\\DEFAULT\\NTUSER.DAT"
            ],
            "windows_registry_read_whitelist": [
              "HKU\\*\\SOFTWARE\\OPENSSH\\AGENT\\KEYS\\*"
            ],
            "windows_registry_read_blacklist": [],
            "linux_paths_other_watched_globs": [
              "/home/*/*",
              "/home/*/*/*",
              "/root/*",
              "/root/*/*",
              "/tmp/**",
              "/dev/shm/**"
            ],
            "use_driver": true,
            "use_process_block": false,
            "antivirus_policy_name": "GENSECEV_HarfangLab_AV_policy",
            "agent_auto_update": false,
            "agent_auto_forget": false,
            "agent_auto_forget_max_days": 1,
            "antivirus_profile": "d060dd94-fe99-4683-900e-f304e74fe97c",
            "antivirus_profile_name": "GENSECEV_HarfangLab_AV_policy",
            "local_endpoint_cache_size": 10240,
            "name": "GENSECEV_HarfangLab_EDR_policy",
            "description": "Used to automatically generate security events **DO NOT TOUCH**",
            "revision": 2,
            "sleeptime": 60,
            "sleepjitter": 10,
            "telemetry_process_state": "live",
            "telemetry_process_limit": false,
            "telemetry_process_limit_value": 1000,
            "telemetry_network_state": "live",
            "telemetry_network_limit": false,
            "telemetry_network_limit_value": 1000,
            "telemetry_log_state": "live",
            "telemetry_log_limit": false,
            "telemetry_log_limit_value": 1000,
            "telemetry_remotethread_state": "live",
            "telemetry_remotethread_limit": false,
            "telemetry_remotethread_limit_value": 1000,
            "telemetry_driverload_state": "live",
            "telemetry_driverload_limit": false,
            "telemetry_driverload_limit_value": 1000,
            "telemetry_powershell_state": "live",
            "telemetry_powershell_limit": false,
            "telemetry_powershell_limit_value": 1000,
            "telemetry_dns_resolution_state": "live",
            "telemetry_dns_resolution_limit": false,
            "telemetry_dns_resolution_limit_value": 1000,
            "telemetry_authentication_state": "live",
            "telemetry_authentication_limit": false,
            "telemetry_authentication_limit_value": 1000,
            "telemetry_usb_activity_state": "live",
            "telemetry_usb_activity_limit": false,
            "telemetry_usb_activity_limit_value": 1000,
            "telemetry_user_group_state": "live",
            "telemetry_user_group_limit": false,
            "telemetry_user_group_limit_value": 1000,
            "telemetry_registry_state": "on_alert",
            "telemetry_registry_limit": false,
            "telemetry_registry_limit_value": 1000,
            "telemetry_raw_device_access_state": "on_alert",
            "telemetry_raw_device_access_limit": false,
            "telemetry_raw_device_access_limit_value": 1000,
            "telemetry_named_pipe_state": "on_alert",
            "telemetry_named_pipe_limit": false,
            "telemetry_named_pipe_limit_value": 1000,
            "telemetry_raw_socket_creation_state": "on_alert",
            "telemetry_raw_socket_creation_limit": false,
            "telemetry_raw_socket_creation_limit_value": 1000,
            "telemetry_network_listen_state": "on_alert",
            "telemetry_network_listen_limit": false,
            "telemetry_network_listen_limit_value": 1000,
            "telemetry_process_access_state": "on_alert",
            "telemetry_process_access_limit": false,
            "telemetry_process_access_limit_value": 1000,
            "telemetry_process_tamper_state": "on_alert",
            "telemetry_process_tamper_limit": false,
            "telemetry_process_tamper_limit_value": 1000,
            "telemetry_url_request_state": "on_alert",
            "telemetry_url_request_limit": false,
            "telemetry_url_request_limit_value": 1000,
            "telemetry_wmi_event_state": "on_alert",
            "telemetry_wmi_event_limit": false,
            "telemetry_wmi_event_limit_value": 1000,
            "telemetry_file_state": "on_alert",
            "telemetry_file_limit": false,
            "telemetry_file_limit_value": 1000,
            "telemetry_file_download_state": "live",
            "telemetry_file_download_limit": false,
            "telemetry_file_download_limit_value": 1000,
            "telemetry_library_load_state": "on_alert",
            "telemetry_library_load_limit": false,
            "telemetry_library_load_limit_value": 1000,
            "telemetry_dotnet_library_state": "on_alert",
            "telemetry_dotnet_library_limit": false,
            "telemetry_dotnet_library_limit_value": 1000,
            "telemetry_alerts_limit": false,
            "telemetry_alerts_limit_value": 1000,
            "binary_download_enabled": false,
            "library_download_enabled": false,
            "thread_download_enabled": false,
            "telemetry_on_alert_enabled": false,
            "telemetry_on_alert_pre_alert_event_count": 5000,
            "telemetry_on_alert_post_alert_max_event_count": 5000,
            "telemetry_on_alert_post_alert_max_duration_secs": 600,
            "loglevel": "DEBUG",
            "sigma_mode": 1,
            "ioc_mode": 1,
            "ioc_scan_written_executable": false,
            "ioc_scan_libraries": false,
            "hlai_mode": 1,
            "hlai_skip_signed_ms": true,
            "hlai_skip_signed_others": false,
            "hlai_scan_libraries": true,
            "hlai_written_executable": true,
            "hlai_pdf": true,
            "hlai_minimum_level": "critical",
            "hlai_scripts_mode": 1,
            "hlai_scripts_minimum_level": "critical",
            "hibou_mode": 0,
            "hibou_skip_signed_ms": false,
            "hibou_skip_signed_others": false,
            "hibou_minimum_level": "critical",
            "yara_mode": 1,
            "yara_skip_signed_ms": true,
            "yara_skip_signed_others": false,
            "yara_scan_written_executable": true,
            "yara_scan_libraries_load": true,
            "ransomguard_mode": 1,
            "ransomguard_heuristic_mode": 1,
            "driverblock_mode": 1,
            "sidewatch_mode": 1,
            "use_isolation": true,
            "linux_use_isolation": true,
            "isolation_exclusions_revision": null,
            "windows_self_protection": true,
            "windows_self_protection_feature_hosts": false,
            "windows_self_protection_feature_safe_mode": true,
            "windows_self_protection_feature_firewall": true,
            "linux_self_protection": true,
            "linux_self_protection_feature_hosts": false,
            "audit_killswitch": false,
            "linux_startup_block": false,
            "feature_callback_tampering": true,
            "feature_process_tampering": true,
            "feature_live_process_heuristics": true,
            "feature_windows_filesystem_events": true,
            "feature_dse_tampering_mode": 1,
            "feature_event_stacktrace": true,
            "feature_ppl_antimalware": false,
            "agent_ui_enabled": false,
            "agent_ui_admin_message": null,
            "agent_ui_notification_scope": 2,
            "agent_ui_notification_level": 4,
            "synchronization_status": null,
            "sigma_ruleset": null,
            "yara_ruleset": null,
            "ioc_ruleset": null,
            "firewall_policy": null,
            "fim_policy": null,
            "antivirus_policy": "d060dd94-fe99-4683-900e-f304e74fe97c",
            "vulnerability_policy": null
          },
          "tenant": null,
          "starttime": "2025-06-11T00:14:58.000000Z",
          "additional_info": {
            "additional_info1": "vagrant",
            "additional_info2": "wks",
            "additional_info3": null,
            "additional_info4": null
          },
          "subnet": {
            "id": "35064b52-fa8a-4357-b21d-87ab8114add2",
            "gateway_ipaddress": "1.2.3.4",
            "gateway_macaddress": "55-55-00-22-33-22",
            "gateway_oui": null,
            "name": null
          },
          "telemetry": null,
          "disk_count": 1,
          "encrypted_disk_count": 0,
          "domainname": "TestGROUP",
          "dnsdomainname": null,
          "hostname": "testhostaname1",
          "osmajor": 10,
          "osminor": 0,
          "osproducttype": "Windows 11 Enterprise Evaluation",
          "machine_serial": "0",
          "has_valid_password": true,
          "firstseen": "2025-06-11T00:15:06.454734Z",
          "lastseen": "2025-06-11T00:27:06.693963Z",
          "lastseen_warning": "2025-06-11T00:26:59.279324Z",
          "lastseen_error": "2025-06-11T00:27:29.279324Z",
          "version": "24.12.11-0bca88184713cdbb85eec416705f6a0baa07f518-dirty",
          "bitness": "x64",
          "distroid": null,
          "domain": null,
          "installdate": "2025-06-11 00:12:06+00:00",
          "ipaddress": "1.2.2.5",
          "ipmask": "255.255.255.0",
          "external_ipaddress": null,
          "osbuild": 22631,
          "osid": "00329-20000-00001-AA837",
          "ostype": "windows",
          "osversion": "10.0.22631",
          "producttype": "worktest",
          "servicepack": null,
          "total_memory": 4277866496,
          "cpu_count": 2,
          "cpu_frequency": 3408,
          "avg_cpu": 2.4,
          "avg_memory": 164448665,
          "avg_system_cpu": 14.4,
          "avg_system_memory": 3037852467,
          "avg_av_cpu": 0,
          "avg_av_memory": 80097280,
          "machine_boottime": "2025-06-11T00:13:20Z",
          "antivirus_name": "HarfangLab Antivirus",
          "antivirus_version": "6.3.23.0",
          "antivirus_rules_version": "108237",
          "antivirus_last_update_date": null,
          "antivirus_rules_last_update_date": "2025-06-10T18:04:36Z",
          "isolation_state": false,
          "isolation_policy": false,
          "driver_enabled": true,
          "driver_policy": false,
          "driver_version": "24.12.11",
          "is_ppl_antimalware": true,
          "rollback_version": null,
          "pinned_version": null,
          "task_statuses": null,
          "uninstall_status": 0,
          "update_status": 0,
          "refresh_properties_status": null,
          "windows_groups_last_update": null,
          "windows_users_last_update": null,
          "refresh_quarantine_status": null,
          "quarantine_last_update": null,
          "boot_loop_protection_end_date": null,
          "boot_loop_protection_boot_count": 1,
          "description": null,
          "effective_sigma_revision": 4156,
          "effective_yara_revision": 878,
          "effective_ioc_revision": 49,
          "effective_whitelist_revision": 2717,
          "effective_driver_blocklists_revision": 31,
          "telemetry_last_update": "2025-06-11T00:26:31.974049Z"
        }

  fields:
    # DEVICE IDENTIFICATION
    - source: "id"
      target: "device.uid"
      type: "string"
      logic: "Direct mapping of HarfangLab agent unique ID"
      description: "Device unique identifier"

    - source: "hostname"
      target: "device.name"
      type: "string"
      logic: "Direct mapping of hostname"
      description: "Device hostname"

    - source: "hostname"
      target: "device.hostname"
      type: "string"
      logic: "Direct mapping of hostname"
      description: "Device fully qualified hostname"

    # OPERATING SYSTEM
    - source: "osproducttype"
      target: "device.os.name"
      type: "string"
      logic: "Direct mapping of OS product type (e.g., 'Windows 10 Professional', 'Ubuntu 20.04')"
      description: "Operating system name and version"

    - source: "ostype"
      target: "device.os.type"
      type: "string"
      logic: "Normalize ostype to OCSF OSTypeStr: WINDOWS→'Windows', LINUX→'Linux', MACOS→'macOS', OTHER→'Other', UNKNOWN→'Unknown'"
      description: "Operating system type"

    - source: "ostype"
      target: "device.os.type_id"
      type: "integer"
      logic: "Map ostype to OCSF OSTypeId: WINDOWS→100, LINUX→200, MACOS→300, OTHER→99, UNKNOWN→0"
      description: "OCSF operating system type ID"

    # DEVICE CLASSIFICATION
    - source: "producttype"
      target: "device.type"
      type: "string"
      logic: "Map producttype: 'Workstation'→'Desktop', 'Server'→'Server', 'Laptop'→'Laptop', else→'Other'"
      description: "Device type"

    - source: "producttype"
      target: "device.type_id"
      type: "integer"
      logic: "Map device type to OCSF DeviceTypeId: Desktop→1, Laptop→2, Server→8, Other→99"
      description: "OCSF device type ID"

    # NETWORK INTERFACES - PRIMARY
    - source: "ipaddress"
      target: "device.network_interfaces[0].ip"
      type: "string"
      logic: "Direct mapping of IP address"
      description: "Primary network interface IP address"

    - source: "subnet.name || 'eth0'"
      target: "device.network_interfaces[0].name"
      type: "string"
      logic: "Direct mapping of subnet name; default to 'eth0' if missing"
      description: "Network interface name"

    - source: "subnet.id"
      target: "device.network_interfaces[0].uid"
      type: "string"
      logic: "Direct mapping of subnet ID"
      description: "Network interface unique identifier"

    - source: "hostname"
      target: "device.network_interfaces[0].hostname"
      type: "string"
      logic: "Direct mapping of hostname for network interface"
      description: "Network interface hostname"

    - source: "static: Wired"
      target: "device.network_interfaces[0].type"
      type: "string"
      logic: "Default to 'Wired'; can be enhanced with interface type detection logic"
      description: "Network interface type"

    - source: "static: 1"
      target: "device.network_interfaces[0].type_id"
      type: "integer"
      logic: "OCSF NetworkInterfaceTypeId for Wired = 1"
      description: "OCSF network interface type ID"

    # PRIMARY IP ADDRESS
    - source: "ipaddress"
      target: "device.ip"
      type: "string"
      logic: "Direct mapping of primary IP address"
      description: "Device primary IP address"

    # NETWORK LOCATION
    - source: "domainname"
      target: "device.domain"
      type: "string"
      logic: "Direct mapping of domain name"
      description: "Device domain or realm"

    - source: "ipmask"
      target: "device.subnet"
      type: "string"
      logic: "Direct mapping of subnet mask/CIDR"
      description: "Device subnet mask"

    # DEVICE MANAGEMENT & TRUST
    - source: "policy"
      target: "device.is_managed"
      type: "boolean"
      logic: "If policy object exists and is not empty, is_managed=true; else false"
      description: "Whether device is managed by policy"

    - source: "has_valid_password"
      target: "device.is_trusted"
      type: "boolean"
      logic: "Direct mapping of password validity; indicates trust status"
      description: "Whether device has valid credentials/password"

    # DEVICE MODEL & VENDOR
    - source: "static: HarfangLab"
      target: "device.vendor_name"
      type: "string"
      logic: "Always 'HarfangLab' as agent vendor"
      description: "Device vendor/manufacturer"

    # TIMESTAMPS
    - source: "firstseen"
      target: "device.created_time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Device first seen timestamp"

    - source: "machine_boottime"
      target: "device.boot_time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Device boot time"

    - source: "lastseen"
      target: "device.updated_time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "Device last seen timestamp"

    - source: "firstseen"
      target: "time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch; use for OCSF event timestamp"
      description: "OCSF event timestamp"

    # DESCRIPTION
    - source: "description || producttype + ' - ' + osproducttype"
      target: "device.desc"
      type: "string"
      logic: "Use description if provided; fallback to '<producttype> - <osproducttype>' (e.g., 'Workstation - Windows 10')"
      description: "Device description"

    # METADATA
    - source: "static: HarfangLab EDR"
      target: "metadata.product.name"
      type: "string"
      logic: "Always 'HarfangLab EDR'"
      description: "Source product name"

    - source: "static: 24.12"
      target: "metadata.product.version"
      type: "string"
      logic: "Fixed HarfangLab product version"
      description: "Product version"

    - source: "static: 1.5.0"
      target: "metadata.version"
      type: "string"
      logic: "Fixed OCSF schema version"
      description: "OCSF schema version"

    # OCSF EVENT CLASSIFICATION
    - source: "static: 2"
      target: "activity_id"
      type: "integer"
      logic: "Always 2 for 'Collect' activity"
      description: "OCSF activity ID"

    - source: "static: Collect"
      target: "activity_name"
      type: "string"
      logic: "Always 'Collect' for asset inventory"
      description: "OCSF activity name"

    - source: "static: Discovery"
      target: "category_name"
      type: "string"
      logic: "Always 'Discovery'"
      description: "OCSF category name"

    - source: "static: 5"
      target: "category_uid"
      type: "integer"
      logic: "Always 5 for Discovery category"
      description: "OCSF category UID"

    - source: "static: Device Inventory Info"
      target: "class_name"
      type: "string"
      logic: "Always 'Device Inventory Info'"
      description: "OCSF class name"

    - source: "static: 5001"
      target: "class_uid"
      type: "integer"
      logic: "Always 5001 for Device Inventory Info"
      description: "OCSF class UID"

    - source: "computed: 500100 + activity_id"
      target: "type_uid"
      type: "integer"
      logic: "Base 500100 + activity_id (2 = 500102)"
      description: "OCSF type UID"

    - source: "computed: class_name + ': ' + activity_name"
      target: "type_name"
      type: "string"
      logic: "Concatenate 'Device Inventory Info: Collect'"
      description: "OCSF type name"

    - source: "static: Informational"
      target: "severity"
      type: "string"
      logic: "Always 'Informational' for inventory events"
      description: "Event severity"

    - source: "static: 1"
      target: "severity_id"
      type: "integer"
      logic: "Always 1 for Informational severity"
      description: "OCSF severity ID"

    # OCSF ENRICHMENT - DEVICE COMPLIANCE & HYGIENE
    - source: "policy.windows_self_protection_feature_firewall"
      target: "enrichments[0].data.Firewall_status"
      type: "string"
      logic: "Extract firewall status from policy; true→'Enabled', false→'Disabled', null→null"
      description: "Firewall protection status"

    - source: "encrypted_disk_count && disk_count"
      target: "enrichments[0].data.Storage_encryption.partitions"
      type: "object"
      logic: "Build partition encryption map: for each disk i in range(disk_count), set 'disk_i' to 'Enabled' if i < encrypted_disk_count, else 'Disabled'"
      description: "Storage partition encryption status"

    - source: "static: compliance"
      target: "enrichments[0].name"
      type: "string"
      logic: "Always 'compliance' for enrichment type"
      description: "Enrichment object name"

    - source: "static: hygiene"
      target: "enrichments[0].value"
      type: "string"
      logic: "Always 'hygiene' for compliance enrichment"
      description: "Enrichment object value"


  ocsf_samples:
    - name: "Device Inventory Info: Collect"
      description: "Transformed HarfangLab api response to OCSF Device Inventory Info event"
      data: |
        {
          "activity_id": 2,
          "activity_name": "Collect",
          "category_name": "Discovery",
          "category_uid": 5,
          "class_name": "Device Inventory Info",
          "class_uid": 5001,
          "type_name": "Device Inventory Info: Collect",
          "type_uid": 500102,
          "severity": "Informational",
          "severity_id": 1,
          "time": 1749316506,
          "metadata": {
            "product": {
              "name": "HarfangLab EDR",
              "version": "24.12.11"
            },
            "version": "1.6.0"
          },
          "device": {
            "uid": "3891597d-8696-4fc4-a260-b04880bdbd68",
            "name": "testhostaname1",
            "hostname": "testhostaname1",
            "type": "Desktop",
            "type_id": 1,
            "vendor_name": "HarfangLab",
            "ip": "1.2.2.5",
            "domain": "TestGROUP",
            "subnet": "255.255.255.0",
            "is_managed": true,
            "is_trusted": true,
            "created_time": 1749316506,
            "boot_time": 1749315200,
            "updated_time": 1749321426,
            "desc": "worktest - Windows 11 Enterprise Evaluation",
            "os": {
              "name": "Windows 11 Enterprise Evaluation",
              "type": "Windows",
              "type_id": 100
            },
            "network_interfaces": [
              {
                "hostname": "testhostaname1",
                "name": "eth0",
                "ip": "1.2.2.5",
                "type": "Wired",
                "type_id": 1,
                "uid": "35064b52-fa8a-4357-b21d-87ab8114add2"
              }
            ]
          }
        }
