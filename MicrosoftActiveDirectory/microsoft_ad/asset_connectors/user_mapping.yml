mapping:
  ocsf_class: "User Inventory Info"
  class_uid: 5003
  version: "1.6.0"

  samples:
    - name: "Active Directory Active User"
      description: "Active Directory user with console access and group membership"
      data: |
        {
          "objectSid": "S-1-5-21-3623811015-3361044348-30300820-1013",
          "userPrincipalName": "mary.jones@example.com",
          "displayName": "Mary Jones",
          "givenName": "Mary",
          "sn": "Jones",
          "mail": "mary.jones@example.com",
          "objectGUID": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
          "userAccountControl": 512,
          "memberOf": [
            "CN=Finance Users,OU=Groups,DC=example,DC=com",
            "CN=All Users,OU=Groups,DC=example,DC=com"
          ],
          "department": "Finance",
          "title": "Financial Analyst",
          "employeeID": "EMP456",
          "physicalDeliveryOfficeName": "New York, NY",
          "mobile": "+1-555-234-5678",
          "telephoneNumber": "+1-555-234-5678",
          "distinguishedName": "CN=mary.jones,OU=Users,DC=example,DC=com",
          "whenCreated": "20200604100000.0Z",
          "whenChanged": "20250826093000.0Z",
          "lastLogonTimestamp": "20250826093000.0Z",
          "pwdLastSet": "20250101110000.0Z",
          "accountExpires": "0",
          "lastLogon": "20250826093000.0Z",
          "badPwdCount": 0,
          "logonCount": 156
        }

    - name: "Active Directory Disabled User"
      description: "Active Directory user with account disabled and expired"
      data: |
        {
          "objectSid": "S-1-5-21-3623811015-3361044348-30300820-1014",
          "userPrincipalName": "robert.smith@example.com",
          "displayName": "Robert Smith",
          "givenName": "Robert",
          "sn": "Smith",
          "mail": "robert.smith@example.com",
          "objectGUID": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
          "userAccountControl": 514,
          "memberOf": [
            "CN=Engineering Users,OU=Groups,DC=example,DC=com"
          ],
          "department": "Engineering",
          "title": "Senior Software Engineer",
          "employeeID": "EMP789",
          "physicalDeliveryOfficeName": "San Francisco, CA",
          "mobile": "+1-555-345-6789",
          "telephoneNumber": "+1-555-345-6789",
          "distinguishedName": "CN=robert.smith,OU=Users,DC=example,DC=com",
          "whenCreated": "20200604100000.0Z",
          "whenChanged": "20250818150000.0Z",
          "lastLogonTimestamp": "20250610140000.0Z",
          "pwdLastSet": "20210101120000.0Z",
          "accountExpires": "20240826150000.0Z",
          "lastLogon": "20250610140000.0Z",
          "badPwdCount": 3,
          "logonCount": 89
        }

  fields:
    # USER IDENTIFICATION
    - source: "objectSid"
      target: "user.uid"
      type: "string"
      logic: "Direct mapping of user SID (Security Identifier)"
      description: "Active Directory user unique identifier (SID)"

    - source: "displayName"
      target: "user.name"
      type: "string"
      logic: "Direct mapping of display name"
      description: "User display name"

    - source: "displayName"
      target: "user.full_name"
      type: "string"
      logic: "Direct mapping of display name as full name"
      description: "User full name (from display name)"

    # ACCOUNT INFORMATION
    - source: "distinguishedName"
      target: "user.account.uid"
      type: "string"
      logic: "Direct mapping of distinguished name"
      description: "Active Directory user DN (Distinguished Name)"

    - source: "userPrincipalName"
      target: "user.account.name"
      type: "string"
      logic: "Direct mapping of user principal name"
      description: "User principal name (UPN)"

    - source: "static: LDAP"
      target: "user.account.type"
      type: "string"
      logic: "Always 'LDAP'"
      description: "Account type identifier"

    - source: "static: 4000"
      target: "user.account.type_id"
      type: "integer"
      logic: "Always 4000 for LDAP account type"
      description: "OCSF account type ID"

    # USER STATUS & SECURITY
    - source: "userAccountControl"
      target: "user.is_enabled"
      type: "boolean"
      logic: "Compute account enabled status; enabled = not (userAccountControl & 2)"
      description: "Whether user account is enabled"

    - source: "memberOf | length > 0"
      target: "user.has_groups"
      type: "boolean"
      logic: "true if user is member of any group, false otherwise"
      description: "Whether user belongs to any groups"

    - source: "memberOf"
      target: "user.groups"
      type: "array[object]"
      logic: "Extract group DNs; create Group objects with DN as uid and parsed CN as name"
      description: "Group memberships"

    - source: "mail"
      target: "user.email_addr"
      type: "string"
      logic: "Direct mapping of email address"
      description: "User email address"

    # ORGANIZATIONAL INFORMATION
    - source: "department"
      target: "user.department"
      type: "string"
      logic: "Direct mapping of department attribute"
      description: "User department"

    - source: "title"
      target: "user.job_title"
      type: "string"
      logic: "Direct mapping of job title"
      description: "User job title"

    - source: "employeeID"
      target: "user.employee_id"
      type: "string"
      logic: "Direct mapping of employee ID"
      description: "Employee ID"

    - source: "physicalDeliveryOfficeName"
      target: "user.office_location"
      type: "string"
      logic: "Direct mapping of office location"
      description: "Office location"

    - source: "mobile"
      target: "user.phone"
      type: "string"
      logic: "Direct mapping of mobile phone number"
      description: "Mobile phone number"

    - source: "telephoneNumber"
      target: "user.work_phone"
      type: "string"
      logic: "Direct mapping of work telephone number"
      description: "Work phone number"

    - source: "objectGUID"
      target: "user.uid_alt"
      type: "string"
      logic: "Direct mapping of GUID; remove curly braces"
      description: "Active Directory user GUID (alternative UID)"

    # DOMAIN INFORMATION
    - source: "distinguishedName"
      target: "user.domain"
      type: "string"
      logic: "Extract domain from DN; parse DC= components into domain format"
      description: "User domain extracted from DN"

    # TEMPORAL INFORMATION
    - source: "whenCreated"
      target: "user.created_time"
      type: "integer"
      logic: "Convert LDAP generalized time (YYYYMMDDhhmmss.0Z) to Unix timestamp"
      description: "User creation timestamp (Unix epoch)"

    - source: "whenChanged"
      target: "user.updated_time"
      type: "integer"
      logic: "Convert LDAP generalized time to Unix timestamp"
      description: "Last change timestamp (Unix epoch)"

    - source: "lastLogonTimestamp"
      target: "user.last_login_time"
      type: "integer"
      logic: "Convert LDAP generalized time to Unix timestamp"
      description: "Last logon timestamp (Unix epoch)"

    - source: "pwdLastSet"
      target: "user.password_last_changed_time"
      type: "integer"
      logic: "Convert Windows FILETIME to Unix timestamp; return null if 0"
      description: "Password last changed timestamp (Unix epoch)"

    - source: "accountExpires"
      target: "user.account_expires_time"
      type: "integer"
      logic: "Convert Windows FILETIME to Unix timestamp; return null if 0 or 9223372036854775807 (never expires)"
      description: "Account expiration timestamp (Unix epoch)"

    - source: "whenCreated"
      target: "time"
      type: "integer"
      logic: "Convert LDAP generalized time to Unix timestamp for OCSF event timestamp"
      description: "OCSF event timestamp (user discovery time)"

    # OCSF EVENT CLASSIFICATION
    - source: "static: 2"
      target: "activity_id"
      type: "integer"
      logic: "Always 2 for 'Collect' activity"
      description: "OCSF activity ID for inventory collection"

    - source: "static: Collect"
      target: "activity_name"
      type: "string"
      logic: "Always 'Collect'"
      description: "OCSF activity name"

    - source: "static: Discovery"
      target: "category_name"
      type: "string"
      logic: "Always 'Discovery'"
      description: "OCSF category name"

    - source: "static: 5"
      target: "category_uid"
      type: "integer"
      logic: "Always 5 for Discovery category"
      description: "OCSF category UID"

    - source: "static: User Inventory Info"
      target: "class_name"
      type: "string"
      logic: "Always 'User Inventory Info'"
      description: "OCSF class name"

    - source: "static: 5003"
      target: "class_uid"
      type: "integer"
      logic: "Always 5003 for User Inventory Info"
      description: "OCSF class UID"

    - source: "computed: 500300 + activity_id"
      target: "type_uid"
      type: "integer"
      logic: "Base 500300 + activity_id (2 = 500302)"
      description: "OCSF type UID"

    - source: "computed: class_name + ': ' + activity_name"
      target: "type_name"
      type: "string"
      logic: "Concatenate 'User Inventory Info: Collect'"
      description: "OCSF type name"

    - source: "static: Informational"
      target: "severity"
      type: "string"
      logic: "Always 'Informational' for inventory events"
      description: "Event severity level"

    - source: "static: 1"
      target: "severity_id"
      type: "integer"
      logic: "Always 1 for Informational severity"
      description: "OCSF severity ID"

    # METADATA
    - source: "static: Microsoft Active Directory"
      target: "metadata.product.name"
      type: "string"
      logic: "Always 'Microsoft Active Directory'"
      description: "Source product name"

    - source: "static: 1.6.0"
      target: "metadata.version"
      type: "string"
      logic: "Fixed OCSF schema version"
      description: "OCSF schema version"

    # OCSF ENRICHMENT - USER LOGIN INFORMATION
    - source: "userAccountControl"
      target: "enrichments[0].data.is_enabled"
      type: "boolean"
      logic: "Compute account enabled status; enabled = not (userAccountControl & 2)"
      description: "Whether user account is enabled"

    - source: "lastLogon"
      target: "enrichments[0].data.last_logon"
      type: "integer"
      logic: "Convert lastLogon datetime to Unix timestamp; return null if year <= 1601 or invalid"
      description: "Last logon timestamp (Unix epoch)"

    - source: "badPwdCount"
      target: "enrichments[0].data.bad_password_count"
      type: "integer"
      logic: "Direct mapping of bad password attempt count"
      description: "Number of failed password attempts"

    - source: "logonCount"
      target: "enrichments[0].data.number_of_logons"
      type: "integer"
      logic: "Direct mapping of logon count"
      description: "Total number of logons"

    - source: "static: login"
      target: "enrichments[0].name"
      type: "string"
      logic: "Always 'login' for user enrichment type"
      description: "Enrichment object name"

    - source: "static: account_security"
      target: "enrichments[0].value"
      type: "string"
      logic: "Always 'account_security' for AD user login enrichment"
      description: "Enrichment object value"

  ocsf_samples:
    - name: "User Inventory Info: Collect"
      description: "Transformed AD user to OCSF User Inventory Info event"
      data: |
        {
          "activity_id": 2,
          "activity_name": "Collect",
          "category_name": "Discovery",
          "category_uid": 5,
          "class_name": "User Inventory Info",
          "class_uid": 5003,
          "type_name": "User Inventory Info: Collect",
          "type_uid": 500302,
          "severity": "Informational",
          "severity_id": 1,
          "time": 1591234567,
          "metadata": {
            "product": {
              "name": "Microsoft Active Directory"
            },
            "version": "1.6.0"
          },
          "user": {
            "uid": "S-1-5-21-3623811015-3361044348-30300820-1013",
            "name": "Mary Jones",
            "full_name": "Mary Jones",
            "email_addr": "mary.jones@example.com",
            "is_enabled": true,
            "domain": "example.com",
            "department": "Finance",
            "job_title": "Financial Analyst",
            "employee_id": "EMP456",
            "office_location": "New York, NY",
            "phone": "+1-555-234-5678",
            "work_phone": "+1-555-234-5678",
            "created_time": 1591234567,
            "updated_time": 1691234000,
            "last_login_time": 1691230000,
            "password_last_changed_time": 1681234567,
            "has_groups": true,
            "account": {
              "uid": "CN=mary.jones,OU=Users,DC=example,DC=com",
              "name": "mary.jones@example.com",
              "type": "LDAP",
              "type_id": 4000
            },
            "groups": [
              {
                "uid": "CN=Finance Users,OU=Groups,DC=example,DC=com",
                "name": "Finance Users"
              }
            ],
            "uid_alt": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
          },
          "enrichments": [
            {
              "name": "login",
              "value": "account_security",
              "data": {
                "is_enabled": true,
                "last_logon": 1691230000,
                "bad_password_count": 0,
                "number_of_logons": 156
              }
            }
          ]
        }
