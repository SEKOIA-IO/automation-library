mapping:
  ocsf_class: "User Inventory Info"
  class_uid: 5003
  ocsf_version: "1.6.0"

  samples:
    - name: "AWS IAM Programmatic User"
      description: "IAM user with programmatic access (API keys) but no console access"
      data: |
        {
          "UserId": "AIDAI23HZ27SI6FQMGNHQ",
          "UserName": "lambda-execution-role",
          "Arn": "arn:aws:iam::123456789012:user/service-role/lambda-execution-role",
          "Path": "/service-role/",
          "CreateDate": "2020-06-04T10:00:00Z",
          "PasswordLastUsed": null,
          "AccessKeys": [
            {
              "AccessKeyId": "AKIA123456789EXAMPLE",
              "Status": "Active",
              "CreateDate": "2020-06-04T10:00:00Z"
            },
            {
              "AccessKeyId": "AKIA987654321EXAMPLE",
              "Status": "Active",
              "CreateDate": "2021-03-15T14:30:00Z"
            }
          ],
          "MFADevices": [],
          "ConsoleAccessEnabled": false,
          "Tags": [
            {
              "Key": "Purpose",
              "Value": "Lambda Execution"
            },
            {
              "Key": "Environment",
              "Value": "Production"
            }
          ]
        }

    - name: "AWS IAM Console User"
      description: "IAM user with console access and MFA enabled"
      data: |
        {
          "UserId": "AIDACKCEVSQ6C2EXAMPLE",
          "UserName": "aws-developer-team",
          "Arn": "arn:aws:iam::123456789012:user/engineering/aws-developer-team",
          "Path": "/engineering/",
          "CreateDate": "2020-06-04T10:00:00Z",
          "PasswordLastUsed": "2025-08-26T09:30:00Z",
          "AccessKeys": [
            {
              "AccessKeyId": "AKIAIOSFODNN7EXAMPLE",
              "Status": "Active",
              "CreateDate": "2025-01-10T11:00:00Z"
            }
          ],
          "MFADevices": [
            {
              "DeviceName": "arn:aws:iam::123456789012:mfa/aws-developer-team",
              "SerialNumber": "arn:aws:iam::123456789012:mfa/aws-developer-team",
              "EnableDate": "2020-07-15T14:00:00Z"
            }
          ],
          "ConsoleAccessEnabled": true,
          "Tags": [
            {
              "Key": "Department",
              "Value": "Engineering"
            },
            {
              "Key": "Environment",
              "Value": "Development"
            }
          ]
        }

  fields:
    # USER IDENTIFICATION
    - source: "UserId"
      target: "user.uid"
      type: "string"
      logic: "Direct mapping of AWS IAM user ID"
      description: "AWS IAM user unique identifier"

    - source: "UserName"
      target: "user.name"
      type: "string"
      logic: "Direct mapping of IAM username"
      description: "AWS IAM username"

    - source: "UserName"
      target: "user.full_name"
      type: "string"
      logic: "Direct mapping of IAM username as full name"
      description: "User full name (from IAM username)"

    # ACCOUNT INFORMATION
    - source: "Arn"
      target: "user.account.uid"
      type: "string"
      logic: "Direct mapping of AWS ARN"
      description: "AWS IAM user ARN (Amazon Resource Name)"

    - source: "UserName"
      target: "user.account.name"
      type: "string"
      logic: "Direct mapping of IAM username"
      description: "Account username"

    - source: "static: AWS IAM"
      target: "user.account.type"
      type: "string"
      logic: "Always 'AWS IAM'"
      description: "Account type identifier"

    - source: "static: 40"
      target: "user.account.type_id"
      type: "integer"
      logic: "Always 40 for AWS IAM account type"
      description: "OCSF account type ID"

    # USER PATH & HIERARCHY
    - source: "Path"
      target: "user.path"
      type: "string"
      logic: "Direct mapping of IAM path hierarchy"
      description: "IAM user path in the hierarchy (e.g., '/service-role/', '/engineering/')"

    # USER STATUS & SECURITY
    - source: "ConsoleAccessEnabled"
      target: "user.is_console_user"
      type: "boolean"
      logic: "true if login profile exists, false otherwise"
      description: "Whether user has AWS Management Console access"

    - source: "MFADevices | length > 0"
      target: "user.has_mfa"
      type: "boolean"
      logic: "true if any MFA device is registered, false otherwise"
      description: "Whether MFA is enabled for user account"

    - source: "AccessKeys | filter(Status='Active') | length"
      target: "user.access_keys_count"
      type: "integer"
      logic: "Count of active (non-deleted) access keys"
      description: "Number of active programmatic access keys"

    - source: "PasswordLastUsed"
      target: "user.password_last_used_time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch; null if never used"
      description: "Password/console last used timestamp (Unix epoch)"

    # TAGS & METADATA
    - source: "Tags[]"
      target: "user.tags"
      type: "object"
      logic: "Convert array of {Key, Value} to key-value object"
      description: "AWS resource tags (key-value pairs for cost allocation, environment, etc.)"

    # TEMPORAL INFORMATION
    - source: "CreateDate"
      target: "user.created_time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch"
      description: "User creation timestamp"

    - source: "CreateDate"
      target: "time"
      type: "timestamp"
      logic: "Convert ISO 8601 to Unix epoch for OCSF event timestamp"
      description: "OCSF event timestamp (user discovery time)"

    # OCSF EVENT CLASSIFICATION
    - source: "static: 2"
      target: "activity_id"
      type: "integer"
      logic: "Always 2 for 'Collect' activity"
      description: "OCSF activity ID for inventory collection"

    - source: "static: Collect"
      target: "activity_name"
      type: "string"
      logic: "Always 'Collect'"
      description: "OCSF activity name"

    - source: "static: Discovery"
      target: "category_name"
      type: "string"
      logic: "Always 'Discovery'"
      description: "OCSF category name"

    - source: "static: 5"
      target: "category_uid"
      type: "integer"
      logic: "Always 5 for Discovery category"
      description: "OCSF category UID"

    - source: "static: User Inventory Info"
      target: "class_name"
      type: "string"
      logic: "Always 'User Inventory Info'"
      description: "OCSF class name"

    - source: "static: 5003"
      target: "class_uid"
      type: "integer"
      logic: "Always 5003 for User Inventory Info"
      description: "OCSF class UID"

    - source: "computed: 500300 + activity_id"
      target: "type_uid"
      type: "integer"
      logic: "Base 500300 + activity_id (2 = 500302)"
      description: "OCSF type UID"

    - source: "computed: class_name + ': ' + activity_name"
      target: "type_name"
      type: "string"
      logic: "Concatenate 'User Inventory Info: Collect'"
      description: "OCSF type name"

    - source: "static: Informational"
      target: "severity"
      type: "string"
      logic: "Always 'Informational' for inventory events"
      description: "Event severity level"

    - source: "static: 1"
      target: "severity_id"
      type: "integer"
      logic: "Always 1 for Informational severity"
      description: "OCSF severity ID"

    # METADATA
    - source: "static: AWS IAM"
      target: "metadata.product.name"
      type: "string"
      logic: "Always 'AWS IAM'"
      description: "Source product name"

    - source: "static: 1.6.0"
      target: "metadata.version"
      type: "string"
      logic: "Fixed OCSF schema version"
      description: "OCSF schema version"

  ocsf_samples:
    - name: "User Inventory Info: Collect"
      description: "Transformed IAM user to OCSF User Inventory Info event"
      data: |
        {
          "activity_id": 2,
          "activity_name": "Collect",
          "category_name": "Discovery",
          "category_uid": 5,
          "class_name": "User Inventory Info",
          "class_uid": 5003,
          "type_name": "User Inventory Info: Collect",
          "type_uid": 500302,
          "severity": "Informational",
          "severity_id": 1,
          "time": 1591275600,
          "metadata": {
            "product": {
              "name": "AWS IAM",
              "version": "1.6.0"
            },
            "version": "1.6.0"
          },
          "user": {
            "uid": "AIDAI23HZ27SI6FQMGNHQ",
            "name": "lambda-execution-role",
            "full_name": "lambda-execution-role",
            "path": "/service-role/",
            "is_console_user": false,
            "has_mfa": false,
            "access_keys_count": 2,
            "password_last_used_time": null,
            "created_time": 1591275600,
            "tags": {
              "Purpose": "Lambda Execution",
              "Environment": "Production"
            },
            "account": {
              "uid": "arn:aws:iam::123456789012:user/service-role/lambda-execution-role",
              "name": "lambda-execution-role",
              "type": "AWS IAM",
              "type_id": 40
            }
          }
        }
